{%- assign collection = section.settings.collection -%}

<style>
    .flash_sale_container {
        width: 100%;
        display: grid;
        grid-template-columns: 1fr 1fr;
        padding: 52px 0;
        gap: 40px;
        align-items: center;
    }

    .flash_content {
        display: flex;
        flex-direction: column;
        justify-content: center;
        width: 100%;
        padding: 10px;
        gap: 30px;
    }

    .content h2 {
        font-size: clamp(2rem, 5vw, 3.5rem);
        margin-bottom: 15px;
        font-weight: 700;
    }

    .content p {
        color: #666;
        line-height: 1.6;
        margin-bottom: 20px;
    }

    .content a {
        display: inline-block;
        padding: 15px 40px;
        background: #000;
        color: #fff;
        text-decoration: none;
        border-radius: 8px;
        transition: all 0.3s;
        width: fit-content;
    }

    .content a:hover {
        background: #333;
    }

    .count_down {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }

    .count_down_title {
        font-size: 1.5rem;
        font-weight: 600;
    }

    .count_down_clock {
        display: flex;
        gap: 10px;
    }

    .time-unit {
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .time-value {
        background: #f5f5f5;
        padding: 15px 20px;
        border-radius: 8px;
        min-width: 70px;
        text-align: center;
        font-size: 2rem;
        font-weight: 700;
        font-family: 'Courier New', monospace;
    }

    .time-label {
        font-size: 0.875rem;
        color: #666;
        margin-top: 5px;
        font-weight: 400;
    }

    /* Slider container */
    .flash_collection {
        position: relative;
        width: 100%;
        padding-bottom: 80px;
    }

    /* SPLIDE VERSION OF YOUR CARD EFFECTS */
    .splide__track {
        overflow: visible !important;
    }

    .splide__list {
        display: flex;
        gap: 20px;
    }

    .splide__slide {
        display: flex;
        justify-content: center;
    }

    .collection {
        height: 420px;
        width: 280px;
        overflow: hidden;
        position: relative;
        transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        opacity: 0.7;
        transform: scale(0.9);
        border-radius: 12px;
    }

    /* Equivalent of .slick-center → Splide uses .is-active */
    .splide__slide.is-active .collection {
        height: 500px;
        width: 350px;
        opacity: 1;
        transform: scale(1);
        z-index: 10;
    }

    .collection img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
    }

    .product-info {
        position: absolute;
        bottom: 20px;
        left: 20px;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        padding: 25px 30px;
        max-width: 70%;
        display: none;
    }

    .splide__slide.is-active .product-info {
        display: block;
    }

    .product-label {
        font-size: 0.75rem;
        color: #999;
        margin-bottom: 8px;
        letter-spacing: 2px;
        text-transform: uppercase;
    }

    .product-discount {
        font-size: 2rem;
        font-weight: 700;
        color: #000;
        margin: 0;
        line-height: 1;
    }

    @media (max-width: 1200px) {
        .flash_sale_container {
            grid-template-columns: 1fr;
            gap: 40px;
        }

        .collection {
            height: 380px;
            width: 250px;
        }

        .splide__slide.is-active .collection {
            height: 450px;
            width: 300px;
        }
    }

    @media (max-width: 768px) {
        .collection {
            height: 350px;
            width: 220px;
        }

        .splide__slide.is-active .collection {
            height: 400px;
            width: 260px;
        }
    }

    @media (max-width: 480px) {
        .collection {
            height: 300px;
            width: 200px;
        }

        .splide__slide.is-active .collection {
            height: 350px;
            width: 240px;
        }
    }
</style>

<div class="flash_sale_container">
    <div class="flash_content">
        <div class="content">
            <h2>{{ section.settings.title }}</h2>
            <p>{{ section.settings.description }}</p>
            <a href="{{ section.settings.button_url }}">{{ section.settings.button_text }}</a>
        </div>

        <div class="count_down">
            <h3 class="count_down_title">{{ section.settings.countdown_title }}</h3>
            <div class="count_down_clock" id="count_down_clock"></div>
        </div>
    </div>

    <div class="flash_collection splide">
        <div class="splide__track">
            <ul class="splide__list">
                {% if collection != blank %}
                    {% for product in collection.products limit: 10 %}
                    <li class="splide__slide">
                        <div class="collection">
                            <img 
                              src="{{ product.featured_image | image_url }}" 
                              alt="{{ product.title }}"
                              loading="lazy" width="100" height="100"
                            >

                            <div class="product-info">
                                <div class="product-label">{{ forloop.index | prepend: '0' | slice: -2, 2 }} — Spring Sale</div>
                                <div class="product-discount">30% OFF</div>
                            </div>
                        </div>
                    </li>
                    {% endfor %}
                {% endif %}
            </ul>
        </div>
    </div>
</div>

<script>  
  /* Countdown */
  let countDownDate = new Date('{{ section.settings.end_date }}').getTime();
  const clockElement = document.getElementById('count_down_clock');

  let x = setInterval(() => {
    const now = Date.now();
    let distance = countDownDate - now;

    if (distance <= 0) {
        clearInterval(x);
        clockElement.innerHTML = '<span class="time-value">Expired</span>';
        return;
    }

    const days = String(Math.floor(distance / 86400000)).padStart(2, '0');
    const hours = String(Math.floor((distance % 86400000) / 3600000)).padStart(2, '0');
    const minutes = String(Math.floor((distance % 3600000) / 60000)).padStart(2, '0');
    const seconds = String(Math.floor((distance % 60000) / 1000)).padStart(2, '0');

    clockElement.innerHTML = `
        <div class="time-unit"><div class="time-value">${days}</div><div class="time-label">Days</div></div>
        <div class="time-unit"><div class="time-value">${hours}</div><div class="time-label">Hr</div></div>
        <div class="time-unit"><div class="time-value">${minutes}</div><div class="time-label">Mins</div></div>
        <div class="time-unit"><div class="time-value">${seconds}</div><div class="time-label">Sec</div></div>
    `;
  }, 1000);

  /* Splide */
  new Splide('.splide', {
    type: 'loop',
    perPage: 3,
    gap: 20,
    focus: 'center',
    pagination: false,
    autoplay: true,
    breakpoints: {
      1024: { perPage: 2 },
      768: { perPage: 1 },
    },
  }).mount();
</script>

{% schema %}
{
  "name": "Fasco Flash Sales Promo",
  "settings": [
      { "type": "collection", "id": "collection", "label": "Collection" },
      { "type": "richtext", "id": "title", "label": "Title" },
      { "type": "richtext", "id": "description", "label": "Description" },
      { "type": "text", "id": "button_text", "label": "Button Text", "default": "Buy Now" },
      { "type": "url", "id": "button_url", "label": "Button Link" },
      { "type": "richtext", "id": "countdown_title", "label": "Countdown Title" },
      { "type": "text", "id": "end_date", "label": "End date" }
  ],
  "presets": [{ "name": "Fasco Flash Sales Promo" }]
}
{% endschema %}
